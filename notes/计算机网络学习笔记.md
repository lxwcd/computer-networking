计算机网络学习笔记

# 学习资源

## 书籍
> 小白入门计算机网络知识：计算机网络 谢希仁 第 7 版
> 看完 计算机网络 后可以补充看：图解TCP_IP
> 对计算机基础网络知识有一定了解后看：趣谈网络协议 刘超 
> linux 上学习网络工具，实操：鸟哥的Linux私房菜服务器架设篇
> 对计算机基础网络知识有一定了解后看，提到很多概论，拓展知识：趣谈网络协议 刘超 



## 视频
> 油管一个计算机网络相关知识科普，适合小白：[PowerCertAnimatedVideos](https://www.youtube.com/@PowerCertAnimatedVideos)


## 学习过程
1. 学习计算机网络基础知识
- 看谢希仁的**计算机网络（第 7 版）** 前 7 章，了解计算机网络基础知识
- 快速看**图解TCP_IP（第 5 版）**，作为查漏补缺
- 鸟哥的Linux私房菜服务器架设篇，学习 linux 中网络工具使用


# 计算机网络基础知识
主要笔记在**计算机网络**和**图解TCP_IP**两本书的笔记中，这里做一些零碎补充

## LAN WAN SUBNET
> [LAN, WAN, SUBNET - EXPLAINED](https://www.youtube.com/watch?v=NyZWSvSj8ek&ab_channel=PowerCertAnimatedVideos)


## 计算机网络体系分层的目的
> [计算机网络为什么要分层](https://www.cnblogs.com/ricklz/p/16457713.html)
> 计算机网络 谢希仁 第7版 1.7

相互通信的计算机必须协调工作，而这种协调十分复杂，分层可以将复杂的问题转换为若干较小的局部问题

分层的好处如下：
- 各层之间独立
每一层不用关心其他层如何实现，仅需知道层间接口所提供的服务
下层对上层透明

- 灵活性好
任意一层发生发生变化，只要层间接口不变，不影响其他层

- 结构上可分割开
各层可以采用最适合自己的技术实现

- 易于实现和维护
不用调试一个十分庞大而复杂的系统，因为每层为一个相对独立的子系统

- 促进标准化工作
每层有自己明确的功能，且有精确说明


分层的缺点：
- 可能有些功能在不同层重复出现而产生额外开销


计算机网络的各层及其协议的集合就是网络的体系结构 (architecture)
计算机的体系结构就是计算机网络及其构件所应完成的功能的精确定义
体系结构是抽象的，其实现靠具体的硬件和软件

## 透明
在计算机网络中，"透明"是一个重要的概念，表示某个组件或系统对于其他组件或系统来说是不可见的，或者说对其他组件的行为没有显著的影响。

以下是几个计算机网络中"透明"概念的例子：

1. 物理层对数据链路层透明：物理层尽可能**屏蔽掉传输媒体和通信手段的差异，使物理层上层的数据链路层感觉不到这些差异**，只用考虑如何完成本层的协议和服务。

2. 传输层透明：在网络通信中，传输层的透明性是指对于应用层来说，传输层提供的传输服务是无差别的，无论底层网络使用的是哪种技术或协议。例如，TCP协议在底层可以使用以太网、Wi-Fi或者其他网络技术实现，但应用程序不需要关心底层的具体实现细节，只需使用统一的套接字接口进行数据的发送和接收。

3. 路由器透明：在计算机网络中，路由器是负责将数据包从源地址转发到目标地址的网络设备。路由器的透明性意味着它在转发数据包时不会对数据内容进行修改或解析。无论是文本、图像还是视频数据，路由器都会透明地将它们传递到下一个网络节点，而不会对数据包本身产生任何影响。

4. 隧道透明：隧道是一种将一个协议的数据封装在另一个协议的数据包中进行传输的方式。隧道协议的透明性表明，封装在隧道中的数据将在传输过程中被保持原样，不会被修改或解析。这样，隧道的两端可以是不同网络或不同协议的设备，但它们仍然可以通过隧道进行通信。

5. 加密透明：加密透明是指在网络通信中使用加密技术时，对于通信的两端来说，使用加密算法进行数据加密和解密是透明的。通信的两端可以像使用非加密通信一样发送和接收数据，中间的加密和解密过程对它们是透明的。这为安全的网络通信提供了便利，同时确保了用户数据的隐私和保密性。

这些例子展示了计算机网络中的"透明"概念，即某个组件或系统的行为对其他组件来说是不可见的。透明性帮助网络中的各个组件相互协作，并简化了网络通信和管理的复杂性。


## 五层协议
OSI 七层协议
- 物理层，数据链路层，网络层，运输层，会话层，表示层，应用层
- 理论模型

TCP/IP 四层协议
- 网络接口层，网际层，运输层，应用层
- 实际使用

五层协议划分
- 物理层，数据链路层，网络层，运输层，应用层

### 物理层
- physical layer
- 传输的数据单位为比特，考虑的是用多大电压表示 1 和 0 以及接收方如何识别发送的比特（编码方式等）
- 物理层还要考虑与传输媒介，如双绞线等接口的一些特性，但具体传输媒介的特性不属于物理层，是在物理层之下
- 物理层尽可能**屏蔽掉传输媒体和通信手段的差异，使物理层上层的数据链路层感觉不到这些差异**，只用考虑如何完成本层的协议和服务

### 数据链路层
- data link layer

数据链路层要解决的三个问题：
- 封装成帧 (framing)
帧的首部和尾部用于帧定界，且包括许多必要的控制信息，发送帧时从帧的首部开始发送。
数据链路层协议对帧首部和帧尾部的格式有明确的规定，也规定了帧的数据部分长度上限，即最大传输单元 **MTU** （Maximum Transfer Unit）。不同数据链路的 MTU 不同。

- 透明传输 
无论什么比特组合的数据，都能按照原样没有差错的通过数据链路层，即数据链路层对这些数据透明
传输的数据不会因为帧定界的方式与数据的来源不兼容而出现错误

- 差错检测
数据链路层将数据封装成帧中包含数据和控制信息，控制信息中含有差错控制，发现差错则丢弃帧
数据链路层使用 CRC 检验，能实现无比特差错的传输，但不是可靠传输，即数据链路层不会检验帧丢失，帧重复或帧失序等差错

对于通信质量良好的有线传输链路，数据链路层协议不使用确认和重传机制，即不向上层提供可靠的传输服务
对于通信质量较差的无线传输链路，数据链路层协议使用确认和重传机制，即不向上层提供可靠的传输服务

### 网络层
- network layer

将运输层产生的报文段或用户数据报封装成分组或包传送给分组交换网上的不同主机
选择合适的路由使得源主机的数据包能到达目的主机

### 运输层
- transport layer

运输层负责向两台主机中进程之间的通信提供通用的数据传输服务，通用指多个应用能使用一个运输层服务

运输层有复用和分用的功能，复用表示多个应用层进程同时使用运输层的服务，
分用表示运输层将收到的信息分别交付给应用层中的相应进程

运输层向高层用户屏蔽下面网络核心的细节（如网络拓扑、所采用的路由协议等），使应用进程看见的就是好像在两个运输层实体之间有一条端到端的逻辑通信信道。

## 三层网络模型
> [Build Your Skills: The three-layer hierarchical model](https://www.techrepublic.com/article/build-your-skills-the-three-layer-hierarchical-model/)
> [3 Layer Cisco Hierarchical Model](https://ipwithease.com/3-layer-cisco-hierarchical-model/)
> [Three-Layer Hierarchical Model in Cisco](https://www.geeksforgeeks.org/three-layer-hierarchical-model-in-cisco/)
> [Network Topology Architectures (2-tier and 3-tier) | Cisco CCNA 200-301](https://www.youtube.com/watch?v=XHlr791Lid0&ab_channel=KeithBarker-TheOGofIT)
> [CCNA Training CBT - Cisco Three Layer Hierarchical Model](https://www.youtube.com/watch?v=vCneK-9nVyI&ab_channel=ITdvds)


- 接入层（access layer）
    - 连接终端到局域网中，如 VLAN 在接入层分开广播域，或者路由器划分的子网。
    - use switches or hubs

- 分发层（distribution layer）
    - 也叫汇聚层，如连接接入层不同的 VLAN，或者接入层不同的子网；如果接入层划分不同子网，分发层连接不同的子网，这些子网仍然属于一个局域网，分发层的路由器有一个路由表用来过滤数据包决定分发给哪个子网。
    - 例如防火墙，NAT 配置等在分发层。
    - use routers to connect multiple networks together

- 核心层（core layer）
    - 复杂高速数据转发，连接分发层的各个设备。


## 集线器 Hub
- 工作在物理层，仅简单地转发比特，半双工通信
- 不进行碰撞检测，因此有 CSMA/CD 协议，保证同一时刻只有一个站点发送数据

## 以太网交换机 switch
- 工作在数据链路层，全双工通信，能隔离冲突域
- 以太网交换机实质是多接口网桥，网桥只有两个接口，以太网交换机接口更多。
- 以太网交换机使用了专门的交换结构芯片，用硬件转发，其转发速率比普通网桥快。
- 以太网交换机有存储器，能进行帧缓存。
- 以太网交换机内有交换表，能进行自学习，交换表中每个条目是每个端口号以及对应的 MAC 地址，交换表有一定的有效时间，过期就删除。
- 以太网交换机是即插即用设备，因为其自有自学习能力，不必人工配置。
- 以太网交换机一般有多种速率接口。 
- 以太网交换机大多数对帧采用存储转发的方式，但也有些采用直通方式交换，直通交换不进行差错检测就将帧发出去。
- 以太网是全双工通信方式。



## 广播域与冲突域
> [Broadcast Domains and Collision Domains - CompTIA Network+ N10-007 - 1.3](https://www.youtube.com/watch?v=SGbtLjIEVeo&ab_channel=ProfessorMesser)
> [CSMA/CD and CSMA/CA Explained](https://www.youtube.com/watch?v=iKn0GzF5-IU&t=103s&ab_channel=PowerCertAnimatedVideos)

- broadcast domain and collision domain

### collision domain
在以太网中，当两个设备同时将数据包发送到同一物理链路上时，这些数据包可能会在传输过程中发生碰撞，导致数据包损坏。
这是因为以太网使用的是半双工通信方式，设备不能同时发送和接收数据。
碰撞域的存在会限制网络的传输效率和可靠性。


- hub 连接的主机为一个 collision domain
- 同一时刻最多只允许一个站点发送数据
- 各主机的网络适配器执行 CSMA/CD 协议以避免冲突
- switch 能隔离冲突域，switch 是全双工通信，且有存储器能对数据进行缓存

### broadcast domain
广播域是指网络中的一组设备，当其中一个设备发送广播消息时，其他设备都能够接收到该消息
广播是一种发送到本地网络上的特殊数据包，其目标地址为广播地址，例如IPv4中的255.255.255.255

- 第二层以太网交换机所连接的设备属于一个广播域
- ARP 广播会在一个广播域中传输
- VLAN 可以隔离广播域
- 路由器可以隔离广播域

## 网络环路和生成树协议 STP
查看 **趣谈网络协议 2.2 节**的讲解


## VLAN 
> [VLAN Explained](https://www.youtube.com/watch?v=jC6MJTh9fRE&ab_channel=PowerCertAnimatedVideos)

- 从逻辑上划分广播域，限制接收广播风暴的计算机数量
- 工作在数据链路层
- 在以太网帧中加入一个 VLAN 标志，占 4 字节，但实际可分配的主机数只有 12 位，即 4096 个主机
- 对交换机有要求
- 二层的交换机只能在一个局域网中划分广播域

## IP 地址和 MAC 地址的区别
> [MAC Address Explained](https://www.youtube.com/watch?v=TIiQiw7fpsU&ab_channel=PowerCertAnimatedVideos)


![](https://img-blog.csdnimg.cn/23b18ee986bb4b04a797e4740fac3195.png)
![](https://img-blog.csdnimg.cn/cb17f7e950c64d7ca660ecb403d4c264.png)


- 在 IP 层抽象的互联网上只能看到 IP 数据报，屏蔽了下层网络硬件地址体系的不同等复杂细节。
- 互联网可以由很多[异构网](https://en.wikipedia.org/wiki/Heterogeneous_network)组成，使用 IP 协议让互联网上的主机好像在一个单个网络上通信，而不用管各网络的具体异构细节。
- IP 数据报首部的源地址和目的地址始终不变，是最终的源和目的地址
- 路由器进行路由是依据 IP 地址，IP 地址更有规律，适合路由器进行路由管理
- IP 地址是软件实现的逻辑地址，很容易变化；物理地址是硬件地址，在网络适配器的 ROM 中，一般不会变化
- 局域网的数据链路层只能看见 MAC 帧，以太网交换机的交换表是根据 MAC 地址进行转发
- MAC 帧经过不同的网络时，其帧首部的源地址和目的地址都要变化，源地址变为当前发送的地址，目的地址下一跳的地址


## 子网（subnet）和 虚拟局域网 VLAN 区别
> [LAN, WAN, SUBNET - EXPLAINED](https://www.youtube.com/watch?v=NyZWSvSj8ek&list=LL&index=5&ab_channel=PowerCertAnimatedVideos)
> [VLAN Explained](https://www.youtube.com/watch?v=jC6MJTh9fRE&t=1s&ab_channel=PowerCertAnimatedVideos)
> [Subnets vs VLANs](https://www.youtube.com/watch?v=6_giEv20En0&list=LL&index=6&ab_channel=PowerCertAnimatedVideos)


- 划分子网是在网络层，通过路由器划分，不同的子网仍属于一个局域网（LAN）。
- 子网是对 IP 地址的主机号分出一些位数作为子网号
- VLAN 是在数据链路层划分，通过以太网交换机，在 MAC 地址中增加一个标志位来区分，逻辑上划分为多个广播域，但多个广播域仍然在一个局域网中。
- 子网是在物理上划分，VLAN 是在逻辑上划分，都是分割不同的广播域。
- 子网和 VLAN 划分均在访问层（access layer），但连接不同的 VALN 和子网则是在 distribution layer。
- 可能有些场景不能使用 VLAN，只能在网络层划分子网。

## TCP 和 UDP 的区别
1. TCP 是面向连接的，UDP 面向无连接
- 面向连接指互相通信前先建立连接
- TCP 进行三次握手来建立连接，而 UDP 不建立连接
TCP 建立连接的原因：
1) 确保双方都准备好进行通信：在建立TCP连接之前，客户端和服务器需要确保双方都已经准备好进行通信。通过三次握手，客户端和服务器可以确保彼此都处于可达状态，并且可以正常地发送和接收数据。

2) 同步序列号 (Synchronize Sequence Numbers)：在三次握手过程中，服务端和客户端将交换彼此的初始序列号（ISN），以确保双方建立起相同的初始序列号。

序列号用于对TCP数据包进行排序和重组。在建立连接时同步序列号非常重要，因为它们用于标识每个TCP连接中的数据包顺序，并帮助检测和处理重复或丢失的数据包。

3) 确认连接请求和响应：通过三次握手，客户端向服务器发送一个连接请求报文段（SYN），表示客户端希望建立连接。 服务器收到请求后，会回复一个确认报文段（SYN-ACK），以确认收到连接请求，并表示服务器也准备好建立连接。最后，客户端再次回复一个确认报文段（ACK），表示已经接收到服务器的确认，并且连接已经建立。

这样来回的确认过程可以防止服务器收到多个重复的连接请求，以及客户端在发送请求后一段时间后便关闭的情况。通过三次握手，确保连接的可靠性和可用性。

2. TCP 不支持广播或多播通信，UDP 可以一对多或多对多等通信
TCP 需要建立连接，数据传送结束要释放连接，因此不支持一对多
UDP 是无连接的，因此可以进行一对多通信

3. TCP 是面向字节流的，UDP 是面向报文的
应用程序交付给 TCP 的是数据块，但 TCP 将其仅看成一连串无结构的字节流，字节流中的每个字节都被按序编号
TCP 连接的连接的两端有发送缓存和接收缓存，提供全双工通信，不关心应用程序一次将多长的报文发送到 TCP 缓存中，
TCP 是根据对方给出的窗口值和当前网络的拥塞程度决定发送多少字节

UDP 对应用层交付的报文不合并也不拆分，添加首部数据后就交给 IP 层，因此应用层最好选择合适大小的报文，
如果报文太长，到 IP 层后需要分片，会降低 IP 层的效率
报文太短也会降低 IP 层的效率

4. TCP 提供可靠交付，UDP 不保证可靠交付
TCP 是有状态的服务，会跟踪数据包发送状态，而 UDP 是无状态的，不管数据是否发送成功或者有无差错等

TCP 能提供可靠传输的原因：
- 面向连接 Connection-oriented
TCP 在通信前进行三次握手和通信结束后四次挥手保证数据的完整交换

- 确认和重传机制
接收方收到数据后会发送 acknowledgments (ACK) 给发送方以告知对方自己收到数据
如果发送方在一定时间内没有收到 ACK 确认消息，则重传数据包
该机制确保数据不丢失

- 为每个字节分配序号
TCP 在建立连接时会发送初始序号 (sequence number)，此后传输数据的包会依序编号，接收方在发送确认消息时也会指明下次发送的序号
接收方根据序号重组数据，保证数据无差错，按序到达

- 流量控制（flow control）
TCP 利用滑动窗口机制让发送方的发送速率不要太快，以便接收方来得及接收

- 拥塞控制（Congestion control）
TCP 通过监控网络拥塞程度来避免过多的数据注入到网络中，使网络中的路由器或链路不至于过载而影响通信

